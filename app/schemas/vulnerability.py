from marshmallow import validate, ValidationError

from app import ma
from app.models.vulnerability import VulnerabilityModel
from app.schemas import BaseSchema
from app.schemas.score import ScoreSchema


class VulnerabilitySchema(BaseSchema):
    class Meta:
        model = VulnerabilityModel

    def validate_cvss(scores):
        for score in scores:
            if not 'cvss_v2' in score and not 'cvss_v3' in score:
                raise ValidationError('At least one of cvss_v2 or cvss_v3 is required.')

    scores = ma.List(
        ma.Nested(ScoreSchema),
        allow_none=True,
        validate=[
            validate.Length(min=1),
            validate_cvss
        ]
    )

        
