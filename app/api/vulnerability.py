from flask_apispec import doc, use_kwargs, marshal_with

from app import db
from app.api import bp
from app.models.vulnerability import VulnerabilityModel
from app.schemas.vulnerability import VulnerabilitySchema


@doc(description='Create a new vulnerability.',
     tags=['vulns'])
@bp.route('/vulns', methods=['POST'])
@use_kwargs(VulnerabilitySchema)
@marshal_with(VulnerabilitySchema, code=201, description='Created')
def create_vulnerability(**kwargs):
    # Create new vulnerability
    vuln = VulnerabilityModel()
    vuln.from_dict(kwargs)
    # Commit to database
    db.session.add(vuln)
    db.session.commit()
    return vuln, 201
